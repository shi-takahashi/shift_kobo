# ä¼‘ã¿å¸Œæœ›æ‰¿èªãƒ•ãƒ­ãƒ¼ ä»•æ§˜æ›¸

## ğŸ“‹ æ¦‚è¦

ã‚¹ã‚¿ãƒƒãƒ•ã®ä¼‘ã¿å¸Œæœ›ã«ç®¡ç†è€…ã®æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ã‚’è¿½åŠ ã™ã‚‹æ©Ÿèƒ½

## ğŸ¯ ç›®çš„

- **ç¾çŠ¶ã®å•é¡Œ**: ã‚¹ã‚¿ãƒƒãƒ•ãŒä¼‘ã¿å¸Œæœ›ã‚’å…¥åŠ›ã™ã‚‹ã¨ç„¡æ¡ä»¶ã§åæ˜ ã•ã‚Œã‚‹
- **å¿…è¦ãªæ”¹å–„**: ç®¡ç†è€…ã®æ‰¿èªã‚’çµŒã¦ã‹ã‚‰æ­£å¼ãªä¼‘ã¿å¸Œæœ›ã¨ã—ã¦æ‰±ã†
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**:
  - ã‚¹ã‚¿ãƒƒãƒ•: ç”³è«‹â†’æ‰¿èªå¾…ã¡çŠ¶æ…‹ã‚’ç¢ºèªâ†’æ‰¿èª/å´ä¸‹é€šçŸ¥ã‚’å—ã‘å–ã‚‹
  - ç®¡ç†è€…: ç”³è«‹ä¸€è¦§ç¢ºèªâ†’æ‰¿èªã¾ãŸã¯å´ä¸‹â†’ã‚¹ã‚¿ãƒƒãƒ•ã«é€šçŸ¥

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### ConstraintRequestï¼ˆæ–°è¦ãƒ¢ãƒ‡ãƒ«ï¼‰

```dart
class ConstraintRequest {
  final String id;
  final String staffId;        // ç”³è«‹è€…ã®ã‚¹ã‚¿ãƒƒãƒ•ID
  final String userId;         // ç”³è«‹è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  final String requestType;    // "specificDay" | "weekday" | "shiftType"
  final DateTime? specificDate; // ç‰¹å®šæ—¥ã®å ´åˆ
  final int? weekday;          // æ›œæ—¥ã®å ´åˆ: 1-7
  final String? shiftType;     // ã‚·ãƒ•ãƒˆã‚¿ã‚¤ãƒ—ã®å ´åˆ
  final String status;         // "pending" | "approved" | "rejected"
  final String? approvedBy;    // æ‰¿èªè€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  final DateTime? approvedAt;  // æ‰¿èªæ—¥æ™‚
  final String? rejectedReason; // å´ä¸‹ç†ç”±
  final DateTime createdAt;
  final DateTime updatedAt;

  // toJson, fromJsonå®Ÿè£…
}
```

### Firestoreã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ 

```
teams/{teamId}/constraint_requests/{requestId}
```

### Security Rules

```javascript
// ä¼‘ã¿å¸Œæœ›ç”³è«‹ï¼ˆæ‰¿èªãƒ•ãƒ­ãƒ¼ï¼‰
match /constraint_requests/{requestId} {
  // å…¨å“¡ãŒé–²è¦§å¯èƒ½ï¼ˆç®¡ç†è€…ï¼šå…¨ä»¶ã€ã‚¹ã‚¿ãƒƒãƒ•ï¼šè‡ªåˆ†ã®ç”³è«‹ã®ã¿ï¼‰
  allow read: if request.auth.uid in get(/databases/$(database)/documents/teams/$(teamId)).data.memberIds;

  // ç”³è«‹ä½œæˆï¼šã‚¹ã‚¿ãƒƒãƒ•è‡ªèº«ã®ã¿ï¼ˆç· ã‚æ—¥å‰ã®ã¿ï¼‰
  allow create: if request.auth.uid in get(/databases/$(database)/documents/teams/$(teamId)).data.memberIds
                   && request.resource.data.userId == request.auth.uid
                   && request.time < get(/databases/$(database)/documents/teams/$(teamId)).data.shiftDeadline;

  // ç”³è«‹æ›´æ–°ï¼šç®¡ç†è€…ã®ã¿ï¼ˆæ‰¿èªãƒ»å´ä¸‹æ“ä½œï¼‰
  allow update: if request.auth.uid in get(/databases/$(database)/documents/teams/$(teamId)).data.adminIds
                   && request.resource.data.keys().hasAny(['status', 'approvedBy', 'approvedAt', 'rejectedReason']);

  // ç”³è«‹å‰Šé™¤ï¼šæœ¬äººã¾ãŸã¯ç®¡ç†è€…
  allow delete: if request.resource.data.userId == request.auth.uid
                   || request.auth.uid in get(/databases/$(database)/documents/teams/$(teamId)).data.adminIds;
}
```

## ğŸ¨ UIè¨­è¨ˆ

### ãƒã‚¤ãƒšãƒ¼ã‚¸ï¼ˆã‚¹ã‚¿ãƒƒãƒ•å´ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãã®ä»–ã®åˆ¶ç´„                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç·¨é›†ãƒœã‚¿ãƒ³ â†’ ç”³è«‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°   â”‚
â”‚                             â”‚
â”‚ â—† ä¼‘ã¿å¸Œæœ›æ›œæ—¥              â”‚
â”‚   [æœˆ] [æ°´] â³æ‰¿èªå¾…ã¡      â”‚
â”‚   [é‡‘] âœ…æ‰¿èªæ¸ˆã¿           â”‚
â”‚                             â”‚
â”‚ â—† å‹¤å‹™ä¸å¯ã‚·ãƒ•ãƒˆã‚¿ã‚¤ãƒ—       â”‚
â”‚   [å¤œå‹¤] â³æ‰¿èªå¾…ã¡         â”‚
â”‚   [é…ç•ª] âŒå´ä¸‹ï¼ˆäººæ‰‹ä¸è¶³ã®ãŸã‚ï¼‰â”‚
â”‚                             â”‚
â”‚ â—† ä¼‘ã¿å¸Œæœ›æ—¥ï¼ˆç‰¹å®šæ—¥ï¼‰       â”‚
â”‚   10/25 â³æ‰¿èªå¾…ã¡          â”‚
â”‚   10/30 âœ…æ‰¿èªæ¸ˆã¿          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ‰¿èªç”»é¢ï¼ˆç®¡ç†è€…å°‚ç”¨ãƒ»æ–°è¦ä½œæˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼‘ã¿å¸Œæœ›æ‰¿èª                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”” æ‰¿èªå¾…ã¡ 3ä»¶             â”‚
â”‚                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ä½è—¤ å¤ªéƒ (10/21 ç”³è«‹)â”‚    â”‚
â”‚ â”‚ ä¼‘ã¿å¸Œæœ›æ›œæ—¥: æœˆãƒ»æ°´   â”‚    â”‚
â”‚ â”‚ [æ‰¿èª] [å´ä¸‹]         â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ç”°ä¸­ èŠ±å­ (10/20 ç”³è«‹)â”‚    â”‚
â”‚ â”‚ ä¼‘ã¿å¸Œæœ›æ—¥: 10/25     â”‚    â”‚
â”‚ â”‚ [æ‰¿èª] [å´ä¸‹]         â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ãƒ•ãƒ­ãƒ¼

### ã‚¹ã‚¿ãƒƒãƒ•å´

1. ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
2. ä¼‘ã¿å¸Œæœ›ã‚’é¸æŠï¼ˆæ›œæ—¥ãƒ»ç‰¹å®šæ—¥ãƒ»ã‚·ãƒ•ãƒˆã‚¿ã‚¤ãƒ—ï¼‰
3. ã€Œä¿å­˜ã€â†’ ConstraintRequestä½œæˆï¼ˆstatus: "pending"ï¼‰
4. ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ã€Œâ³æ‰¿èªå¾…ã¡ã€ãƒãƒƒã‚¸è¡¨ç¤º
5. ç®¡ç†è€…ãŒæ‰¿èª â†’ ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥å—ä¿¡
6. ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ã€Œâœ…æ‰¿èªæ¸ˆã¿ã€ãƒãƒƒã‚¸è¡¨ç¤º
7. ã¾ãŸã¯å´ä¸‹ â†’ ã€ŒâŒå´ä¸‹ï¼ˆç†ç”±ï¼‰ã€ãƒãƒƒã‚¸è¡¨ç¤º

### ç®¡ç†è€…å´

1. è¨­å®šç”»é¢ â†’ ã€Œä¼‘ã¿å¸Œæœ›æ‰¿èªã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆç®¡ç†è€…ã®ã¿è¡¨ç¤ºï¼‰
2. æ‰¿èªç”»é¢ã§ç”³è«‹ä¸€è¦§ç¢ºèª
3. å„ç”³è«‹ã®è©³ç´°ç¢ºèª
4. æ‰¿èªãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
   - status â†’ "approved"
   - Staffãƒ‡ãƒ¼ã‚¿ã«åæ˜ ï¼ˆpreferredDaysOffç­‰ã‚’æ›´æ–°ï¼‰
   - FCMã§ã‚¹ã‚¿ãƒƒãƒ•ã«é€šçŸ¥
5. ã¾ãŸã¯å´ä¸‹ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
   - å´ä¸‹ç†ç”±å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
   - status â†’ "rejected"
   - rejectedReason ã‚’è¨­å®š
   - FCMã§ã‚¹ã‚¿ãƒƒãƒ•ã«é€šçŸ¥

### ç®¡ç†è€…è‡ªèº«ã®ä¼‘ã¿å¸Œæœ›

- ç®¡ç†è€…ãŒè‡ªåˆ†ã®ä¼‘ã¿å¸Œæœ›ã‚’ç·¨é›†ã™ã‚‹å ´åˆã¯**å³æ™‚åæ˜ **
- ConstraintRequestã‚’ä½œæˆã›ãšã€Staffãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥æ›´æ–°ï¼ˆå¾“æ¥é€šã‚Šï¼‰
- æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ã¯ä¸è¦

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
lib/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ constraint_request.dart         ğŸ†• æ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ providers/
â”‚   â””â”€â”€ constraint_request_provider.dart ğŸ†• æ‰¿èªãƒªã‚¯ã‚¨ã‚¹ãƒˆProvider
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ my_page_screen.dart             ğŸ”„ ç”³è«‹æ©Ÿèƒ½è¿½åŠ ãƒ»çŠ¶æ…‹è¡¨ç¤º
â”‚   â”œâ”€â”€ settings_screen.dart            ğŸ”„ æ‰¿èªç”»é¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
â”‚   â””â”€â”€ approval/
â”‚       â””â”€â”€ constraint_approval_screen.dart ğŸ†• æ‰¿èªç”»é¢
â””â”€â”€ widgets/
    â””â”€â”€ constraint_request_card.dart    ğŸ†• ç”³è«‹ã‚«ãƒ¼ãƒ‰ï¼ˆæ‰¿èªç”»é¢ç”¨ï¼‰
```

## âœ… å®Ÿè£…ã‚¿ã‚¹ã‚¯ï¼ˆ6é€±ç›®ï¼‰

### Phase 1: ãƒ‡ãƒ¼ã‚¿å±¤ï¼ˆ2æ—¥ï¼‰
- [ ] ConstraintRequestãƒ¢ãƒ‡ãƒ«ä½œæˆ
- [ ] ConstraintRequestProviderä½œæˆ
- [ ] Firestoreæ§‹é€ è¿½åŠ ãƒ»Security Rulesæ›´æ–°
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆ

### Phase 2: ã‚¹ã‚¿ãƒƒãƒ•å´UIï¼ˆ3æ—¥ï¼‰
- [ ] ãƒã‚¤ãƒšãƒ¼ã‚¸ç·¨é›†æ©Ÿèƒ½ã‚’ç”³è«‹ã«å¤‰æ›´
- [ ] ç”³è«‹çŠ¶æ…‹è¡¨ç¤ºï¼ˆæ‰¿èªå¾…ã¡ãƒ»æ‰¿èªæ¸ˆã¿ãƒ»å´ä¸‹ãƒãƒƒã‚¸ï¼‰
- [ ] ç®¡ç†è€…ã®å³æ™‚åæ˜ å‡¦ç†ï¼ˆå¾“æ¥é€šã‚Šï¼‰
- [ ] UIãƒ†ã‚¹ãƒˆ

### Phase 3: ç®¡ç†è€…å´UIï¼ˆ2æ—¥ï¼‰
- [ ] æ‰¿èªç”»é¢ä½œæˆï¼ˆconstraint_approval_screen.dartï¼‰
- [ ] ç”³è«‹ä¸€è¦§è¡¨ç¤º
- [ ] æ‰¿èªãƒ»å´ä¸‹å‡¦ç†
- [ ] å´ä¸‹ç†ç”±å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- [ ] UIãƒ†ã‚¹ãƒˆ

### Phase 4: é€šçŸ¥åŸºç›¤æº–å‚™ï¼ˆé¸æŠãƒ»7é€±ç›®ã§å®Ÿè£…ï¼‰
- [ ] FCMåŸºç›¤è¨­å®šï¼ˆ6é€±ç›®ã§æº–å‚™ã®ã¿ï¼‰
- [ ] æ‰¿èªæ™‚ã®é€šçŸ¥å®Ÿè£…ï¼ˆ7é€±ç›®ï¼‰
- [ ] å´ä¸‹æ™‚ã®é€šçŸ¥å®Ÿè£…ï¼ˆ7é€±ç›®ï¼‰

### Phase 5: ç· ã‚æ—¥åˆ¶å¾¡ï¼ˆæ®‹ã‚Šæ™‚é–“ã§å®Ÿè£…ï¼‰
- [ ] è¨­å®šç”»é¢ã«ç· ã‚æ—¥è¨­å®šè¿½åŠ 
- [ ] ç· ã‚æ—¥å¾Œã®ç”³è«‹åˆ¶é™
- [ ] Security Rulesåæ˜ 

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### ã‚¹ã‚¿ãƒƒãƒ•å´
1. ä¼‘ã¿å¸Œæœ›ç”³è«‹â†’æ‰¿èªå¾…ã¡è¡¨ç¤ºç¢ºèª
2. ç”³è«‹å¾Œã€ãƒã‚¤ãƒšãƒ¼ã‚¸ã§çŠ¶æ…‹ç¢ºèª
3. æ‰¿èªå¾Œã€æ‰¿èªæ¸ˆã¿ãƒãƒƒã‚¸è¡¨ç¤ºç¢ºèª
4. å´ä¸‹å¾Œã€å´ä¸‹ãƒãƒƒã‚¸+ç†ç”±è¡¨ç¤ºç¢ºèª

### ç®¡ç†è€…å´
1. æ‰¿èªç”»é¢ã§ç”³è«‹ä¸€è¦§è¡¨ç¤ºç¢ºèª
2. æ‰¿èªå‡¦ç†â†’Staffãƒ‡ãƒ¼ã‚¿åæ˜ ç¢ºèª
3. å´ä¸‹å‡¦ç†â†’å´ä¸‹ç†ç”±å…¥åŠ›ãƒ»ä¿å­˜ç¢ºèª
4. è‡ªåˆ†ã®ä¼‘ã¿å¸Œæœ›ã¯å³æ™‚åæ˜ ç¢ºèª

### çµ±åˆãƒ†ã‚¹ãƒˆ
1. ã‚¹ã‚¿ãƒƒãƒ•Aç”³è«‹â†’ç®¡ç†è€…æ‰¿èªâ†’ã‚¹ã‚¿ãƒƒãƒ•Aç¢ºèªï¼ˆæ‰¿èªæ¸ˆã¿ï¼‰
2. ã‚¹ã‚¿ãƒƒãƒ•Bç”³è«‹â†’ç®¡ç†è€…å´ä¸‹â†’ã‚¹ã‚¿ãƒƒãƒ•Bç¢ºèªï¼ˆå´ä¸‹+ç†ç”±ï¼‰
3. ç®¡ç†è€…ãŒè‡ªåˆ†ã®å¸Œæœ›ç·¨é›†â†’å³æ™‚åæ˜ 

## ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| æ—¥ | ã‚¿ã‚¹ã‚¯ |
|----|--------|
| 1-2æ—¥ç›® | ãƒ‡ãƒ¼ã‚¿å±¤å®Ÿè£… |
| 3-5æ—¥ç›® | ã‚¹ã‚¿ãƒƒãƒ•å´UI |
| 6-7æ—¥ç›® | ç®¡ç†è€…å´UI |

**å®Œäº†ç›®æ¨™**: 6é€±ç›®çµ‚äº†æ™‚ï¼ˆ7æ—¥å¾Œï¼‰

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- README-online.mdï¼ˆ6é€±ç›®ã‚¿ã‚¹ã‚¯è©³ç´°ï¼‰
- CLAUDE.mdï¼ˆæ¬¡å›ä½œæ¥­å†…å®¹ï¼‰
- Firestoreãƒ‡ãƒ¼ã‚¿æ§‹é€ è¨­è¨ˆï¼ˆREADME-online.md 4.1ç¯€ï¼‰
